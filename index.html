<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Skydive Waypoint</title>
<style>
  body { font-family: "Segoe UI", sans-serif; background: #111; color: #fff; display:flex; justify-content:center; align-items:center; height:100vh;}
  #container { text-align:center; background: rgba(0,0,0,0.7); padding: 20px; border-radius: 12px; box-shadow: 0 0 15px rgba(0,0,0,0.5);}
  input, button { padding:8px; margin:5px; border-radius:5px; border:none; width: 220px; text-align: center;}
  button { background: #00b86b; color: #fff; cursor:pointer; }
  #status { margin-top: 10px; font-weight: bold; }
</style>
</head>
<body>
<div id="container">
  <h2>Skydive Waypoint Setter</h2>
  <input type="password" id="apiKey" placeholder="Enter your API Key"><br>
  <input type="number" id="vrpId" placeholder="Enter your VRP ID"><br>
  <button onclick="setWaypoint()">Set Nearest Skydive</button>
  <p id="status"></p>
</div>

<script>
const SKYDIVE_LOCATIONS = [
  {x: 1234, y: 5678}, // Replace with your real in-game skydive coordinates
  {x: -2345, y: 3456},
  {x: 987, y: -876}
];

async function setWaypoint() {
  const key = document.getElementById("apiKey").value.trim();
  const vrp = parseInt(document.getElementById("vrpId").value);
  const status = document.getElementById("status");
  
  if (!key || !vrp) { 
    status.innerText = "Enter both API key and VRP ID"; 
    return; 
  }

  try {
    status.innerText = "Fetching positions...";
    const res = await fetch("https://tycoon-2epova.users.cfx.re/status/map/positions.json", {
      headers: { "X-Tycoon-Key": key }
    });
    
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    
    // Find player by VRP ID (index 2)
    const player = data.players.find(p => p[2] === vrp);
    if (!player) { 
      status.innerText = "VRP ID not found on this server"; 
      return; 
    }

    const pos = player[3]; // index 3 = position object {y,h,x,z}
    const px = pos.x, py = pos.y;

    // Find nearest skydive
    let nearest = SKYDIVE_LOCATIONS[0];
    let minDist = distance(px, py, nearest.x, nearest.y);
    for (let loc of SKYDIVE_LOCATIONS) {
      const d = distance(px, py, loc.x, loc.y);
      if (d < minDist) { minDist = d; nearest = loc; }
    }

    // Call setWaypoint
    fetch(`https://tycoon-2epova.users.cfx.re/setWaypoint?x=${nearest.x}&y=${nearest.y}`, {
      headers: { "X-Tycoon-Key": key }
    }).then(r => {
      status.innerText = "✅ Waypoint set to nearest skydive!";
    }).catch(err => { 
      status.innerText = "❌ Error setting waypoint"; 
      console.error(err); 
    });

  } catch (err) {
    status.innerText = "❌ Error fetching positions";
    console.error(err);
  }
}

function distance(x1, y1, x2, y2) {
  return Math.sqrt((x2-x1)**2 + (y2-y1)**2);
}
</script>
</body>
</html>
