<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Skydive Waypoint</title>
<style>
  body { margin:0; background:transparent; font-family:Segoe UI,sans-serif; color:#fff;}
  #widget {
    position:fixed; bottom:20px; right:20px;
    background:rgba(0,0,0,0.6); border-radius:12px; padding:12px 20px;
    text-align:center; min-width:220px; box-shadow:0 0 15px rgba(0,0,0,0.4);
  }
  #widget:hover { background:rgba(0,0,0,0.8); }
  input { width:100%; padding:6px; margin:4px 0; border-radius:6px; border:none; }
  button { padding:6px 12px; margin-top:4px; border:none; border-radius:6px; background:#00b86b; color:white; cursor:pointer; }
  #nearest { margin-top:8px; font-weight:bold; word-break:break-word; }
</style>
</head>
<body>
<div id="widget">
  <input type="text" id="vrpidInput" placeholder="Your VRPid">
  <input type="password" id="apiKeyInput" placeholder="Private API Key">
  <button onclick="setNearestSkydive()">Set Nearest Skydive Waypoint</button>
  <div id="nearest"></div>
</div>

<script>
const skydiveLocations = [
  {name:"Alpha", x:200, y:300, z:100},
  {name:"Beta", x:-1500, y:2500, z:100},
  {name:"Gamma", x:1000, y:-2000, z:100}
];

// Only servers you are using
const servers = [
  {id:"2epova"},
  {id:"njyvop"}
];

async function setNearestSkydive() {
  const vrpid = document.getElementById("vrpidInput").value.trim();
  const apiKey = document.getElementById("apiKeyInput").value.trim();
  if(!vrpid || !apiKey) return alert("Enter VRPid and Private API Key");

  document.getElementById("nearest").innerText = "Detecting server and position...";

  let serverId = null;
  let playerPos = null;

  for(const server of servers){
    try{
      const mapRes = await fetch(`https://tycoon-${server.id}.users.cfx.re/status/map/positions.json?v=${Date.now()}`, {
        headers: {"X-Tycoon-Key": apiKey}
      });
      if(!mapRes.ok) continue;
      const mapData = await mapRes.json();
      const player = mapData.players.find(p => p[2]==vrpid);
      if(player){
        serverId = server.id;
        playerPos = player[3]; // {x, y, z}
        break;
      }
    }catch(e){ continue; }
  }

  if(!serverId || !playerPos){
    document.getElementById("nearest").innerText = "VRPid not found on any server";
    return;
  }

  // Find nearest skydive
  let nearest = skydiveLocations[0];
  let minDist = distance(playerPos, nearest);
  for(const loc of skydiveLocations){
    const dist = distance(playerPos, loc);
    if(dist<minDist){ minDist=dist; nearest=loc; }
  }

  document.getElementById("nearest").innerText = `Nearest Skydive: ${nearest.name} (${Math.round(minDist)}m)`;

  // Set waypoint
  if(window.setWaypoint) window.setWaypoint(nearest.x, nearest.y);
}

function distance(a,b){ return Math.sqrt((a.x-b.x)**2 + (a.y-b.y)**2 + (a.z-b.z)**2); }
</script>
</body>
</html>
